---
title: CAP
---
__当前系统，只能满足 CP ，不能满足 A（高可用）__



## 设计原则

既然是 分布式 系统，则 P 肯定是满足的，当 集群中，某部分 节点 发生网络错误时。（可能 发生网络错误的节点不可用 放弃 A ，也可能是 网络错误的 部分节点 数据也是可用的，但是，只能访问本地数据 放弃 C）。

当前系统的设计是，放弃 A。

首先说，当前系统，没有 心跳机制，中心服务器 不能实时监测 所有节点 是否 可用。也没有自动熔断机制 和 服务自动降级 功能 。

所以，当 某些网络节点 发生 问题 时，所有 请求到 错误 节点的 数据，均 访问失败。其他节点 正常使用。所以，可以保证 数据一致性 C。



## 弥补措施

不过 当前系统 也有 部分弥补措施。

比如 某个 服务 的 10 个 路由节点中，有 两个 不可用时，可以 在 即将执行到 当前 服务的 任何请求 发起调用前，执行 被插入的代码(插入代码 可以进行 请求拦截，和 请求更改)，通过 执行插入代码，把 原本请求到 错误节点的 消息，发送到 正常 能执行 服务的 路由节点。



### 代码挂载点

>  当前 系统中，在 RPC 调用过程中， 共有 4处代码挂载点 。分别是，
> 1、请求 发起方 的 发送请求前。
> 2、请求 接收方 的 本地服务执行前。
> 3、请求 接收方 的 本地服务执行后。
> 4、请求 发起方 的 收到 请求回执 之后，的 本地 回调方法执行前。

因此，可以通过 这 4个 代码挂载点，进行 请求拦截，请求转发，修改 请求信息，等等 一系列 操作。